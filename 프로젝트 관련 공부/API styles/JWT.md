
# JWT란

JWT(JSON Web Token)는 당사자 간에 정보를 JSON 객체 형태로 안전하게 전송하기 위한 개방형 표준(RFC 7519)이다.<br>
서버가 클라이언트의 상태를 기억할 필요 없는 무상태성(Stateless)을 띠기 때문에 서버 확장성이 뛰어나며, 현대 웹 애플리케이션의 인증(Authentication) 및 인가(Authorization)에서 표준으로 사용된다.

# JWT의 구조 (Header.Payload.Signature)

JWT는 점(`.`)을 구분자로 사용하여 세 부분으로 나뉨.

- **Header (헤더):** * 토큰의 타입(`typ`: JWT)과 서명 생성에 사용된 암호화 알고리즘(`alg`: HS256, RS256 등) 정보를 담음.
    
    - 이 정보는 Base64Url로 인코딩됨.
        
- **Payload (페이로드):** * 서버와 클라이언트가 주고받을 실제 데이터인 '클레임(Claim)'이 들어감.
    
    - 유저 식별자(`sub`), 만료 시간(`exp`), 권한(`role`) 등의 정보가 포함됨.
        
    - **주의점:** 암호화(Encryption)가 아닌 단순 Base64Url 인코딩이므로, 누구나 디코딩해서 내용을 읽을 수 있음. 따라서 비밀번호 같은 민감 정보는 절대 넣으면 안 됨.
        
- **Signature (서명):** * 토큰이 중간에 위변조되지 않았음을 검증하는 가장 중요한 부분임.
    
    - 인코딩된 헤더와 인코딩된 페이로드를 합친 뒤, 서버만 알고 있는 비밀키(Secret Key)를 사용해 헤더에 명시된 알고리즘으로 해싱하여 만듦.
        
    - 해커가 페이로드의 데이터를 조작하더라도 서버의 비밀키를 모르기 때문에 올바른 서명을 만들 수 없고, 서버는 서명 불일치로 조작된 토큰을 즉시 걸러냄.

# Access / Refresh Token 흐름

토큰이 탈취당할 위험(보안)과 매번 로그인해야 하는 불편함(UX) 사이의 균형을 맞추기 위해 두 개의 토큰을 나누어 운용함.

- **Access Token:** 실제 API 접근 시 사용하는 '출입증'. 탈취 시 피해를 줄이기 위해 수명을 아주 짧게(예: 15분~1시간) 설정함.
    
- **Refresh Token:** Access Token이 만료되었을 때 새로운 출입증을 발급받기 위한 '교환권'. 수명을 길게(예: 1~2주) 설정하고 안전한 곳에 보관함.

**기본 동작 흐름:**

1. 사용자 로그인 성공 시 서버는 Access/Refresh Token을 모두 발급함.
    
2. 클라이언트는 API 요청 시 헤더에 Access Token을 실어 보냄.
    
3. 시간이 지나 Access Token이 만료되면, 서버는 401(Unauthorized) 에러를 반환함.
    
4. 클라이언트는 이를 감지하고, 보관해 둔 Refresh Token을 서버로 보내 새로운 Access Token을 요청함 (Silent Refresh).
    
5. 새 Access Token을 발급받으면, 실패했던 원래 API 요청을 자동으로 재시도함.


# 만료처리(Expiration)

- **서버 측:** 페이로드에 포함된 `exp` (Expiration Time) 클레임을 확인하여 처리함. API 요청이 들어올 때마다 서명을 먼저 검증한 후, `exp` 값이 현재 시간보다 과거인지 체크하여 만료 여부를 판단한다.
    
- **클라이언트 측:** Access Token이 만료되어 401 에러가 발생할 때마다 사용자를 로그아웃시키면 UX가 매우 나빠짐. 따라서 프론트엔드의 HTTP 클라이언트(예: Axios)에서 인터셉터(Interceptor) 기능을 활용해, 401 에러 발생 시 백그라운드에서 조용히 토큰을 갱신하고 요청을 이어가도록 처리하는 것이 필수적이다.


# 저장위치의 보안 트레이드오프

| **저장 위치**             | **특징 및 장점**                                        | **단점 및 보안 취약점**                                                                                           |
| --------------------- | -------------------------------------------------- | --------------------------------------------------------------------------------------------------------- |
| **Local Storage**     | 자바스크립트로 접근이 쉬워 구현이 매우 편함.                          | **XSS(크로스 사이트 스크립팅) 공격에 치명적.** 악성 스크립트가 로컬 스토리지를 열어 토큰을 그대로 훔쳐갈 수 있음.                                     |
| **Cookie (HttpOnly)** | `HttpOnly` 옵션을 켜면 자바스크립트로 접근할 수 없어 XSS 공격을 원천 차단함. | **CSRF(크로스 사이트 요청 위조) 공격에 취약.** 브라우저가 특정 도메인으로 요청 시 알아서 쿠키를 실어 보내기 때문에, 해커가 사용자를 조종해 강제로 요청을 보내게 만들 수 있음. |

**하이브리드 아키텍처:**

1. **Access Token:** 자바스크립트의 **메모리(로컬 변수, 전역 상태 등)**에 저장함. XSS 공격으로 털리기 어렵고 쿠키가 아니라서 CSRF도 피할 수 있음. (단, 새로고침 시 날아감)
    
2. **Refresh Token:** **`HttpOnly`와 `SameSite` 옵션이 적용된 쿠키**에 저장함. 자바스크립트 접근을 막고(XSS 방어), 타 도메인에서의 자동 전송을 막음(CSRF 방어).
    
3. **조합:** 새로고침 시 메모리의 Access Token이 날아가면, 안전한 쿠키에 담긴 Refresh Token을 통해 서버에서 새 Access Token을 발급받아 다시 메모리에 올림.