
# OAuth 2.0 및 OIDC 핵심 개념 정리

## 1. 핵심 정의 (OAuth vs OIDC)

- **OAuth 2.0 (인가 - Authorization)**
    
    - 타사 서비스(예: 구글)의 자원에 접근할 수 있는 **'권한(출입증)'**을 얻기 위한 프로토콜이다.
        
    - 발급 토큰: `Access Token`
        
- **OIDC (OpenID Connect) (인증 - Authentication)**
    
    - OAuth 2.0 위에서 동작하며, 로그인한 사용자의 **'신원(신분증)'**을 명확히 확인하기 위한 표준이다.
        
    - 발급 토큰: `ID Token` (JWT 형태)
        

## 2. 주요 등장인물

- **Resource Owner (사용자):** 구글 계정의 실제 소유자.
    
- **Client (클라이언트):** 우리가 개발하는 서비스(FastAPI 백엔드). 구글 입장에서는 권한을 요청하는 '고객'이다.
    
- **Authorization Server (인가 서버):** 사용자 동의를 받고 토큰을 발급해 주는 구글의 인증 서버.
    
- **Resource Server (자원 서버):** 사용자의 실제 데이터(이메일, 프로필, 캘린더 등)를 보관하고 있는 구글 API 서버.
    

## 3. Authorization Code Grant 핵심 흐름 (5단계)

가장 널리 쓰이고 안전한 방식이다. 핵심은 진짜 토큰을 브라우저에 바로 주지 않고, **임시 코드(Code)**를 한 번 거친다는 점이다.

1. **로그인 요청 (Redirect):** 사용자가 '구글 로그인' 클릭 시, 클라이언트(백엔드)는 사용자를 구글 로그인 페이지로 리다이렉트한다. 이때 콜백 URL(`redirect_uri`)과 요구 권한(`scope`)을 함께 보낸다.
    
2. **사용자 동의 (Consent):** 사용자가 로그인한 뒤, 클라이언트가 자신의 정보(이메일 등)에 접근하는 것을 허락(동의)한다.
    
3. **임시 코드 발급 (Callback):** 구글은 사용자를 다시 클라이언트의 `redirect_uri`로 돌려보낸다. 이때 URL 파라미터에 짧은 수명의 **임시 교환권(`code`)**을 쥐여 보낸다.
    
4. **토큰 교환 (Token Exchange):** 클라이언트(백엔드)는 획득한 `code`와 서버 비밀번호(`client_secret`)를 들고 구글 인가 서버와 직접 통신(백엔드 간 HTTP POST)하여 진짜 **토큰(`Access Token`, `ID Token`)**으로 교환한다.
    
5. **정보 확인 및 자체 로그인:** 클라이언트는 획득한 토큰으로 유저 식별자(이메일 등)를 파악한 뒤, 자체 DB를 조회하여 회원가입 또는 로그인 처리를 완료한다.
    

## 4. 실무 핵심 및 보안 포인트

- **왜 토큰을 바로 주지 않고 Code를 거치는가?**
    
    - 브라우저(프론트엔드)로 만능 출입증인 토큰이 직접 전달되면 탈취 위험이 높다. 프론트엔드에는 수명이 짧은 임시 `code`만 노출하고, 실제 토큰 교환은 해커가 볼 수 없는 '서버 대 서버(백엔드)' 간 통신으로만 처리하기 위함이다.
        
- **Client Secret의 역할은 무엇인가?**
    
    - 우리 백엔드 서버가 구글 서버에 자신을 증명하기 위한 '서버용 비밀번호'다. 프론트엔드나 깃허브 코드 저장소에 절대 노출되어서는 안 되며, 백엔드 환경변수(`.env`)에 안전하게 숨겨야 한다.
        
- **Access Token vs ID Token의 차이**
    
    - `Access Token`: 구글 API(자원 서버)에 접근해 데이터를 꺼내오기 위한 **출입증**. (예: 캘린더 데이터 조회)
        
    - `ID Token`: 사용자 신원 정보가 즉시 읽을 수 있게 담긴 **신분증**(JWT 형태). OIDC에서 제공하며, 이 토큰을 디코딩하면 추가 API 호출 없이도 유저 이메일 등을 바로 알 수 있다.
        
- **인증 상태의 바통 터치 (Baton Touch)**
    
    - 구글 로그인 성공 후 유저의 신원이 파악되면, 소셜 토큰은 목적을 다한 것이다. 이후 사용자가 우리 서비스를 이용할 때는 소셜 토큰이 아닌, 우리 백엔드가 자체 발급한 '세션(Session)이나 자체 JWT'를 통해 인증 상태를 유지한다.